<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>: Spider::ControllerMixins::HTTPMixin [Spider documentation]</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../../../rdoc-style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>Module</span>
          Spider::ControllerMixins::HTTPMixin
        </h1>
        <ol class='paths'>
          <li>
            <a href="../../../files/lib/spiderfw/controller/mixins/http_mixin_rb.html">lib/spiderfw/controller/mixins/http_mixin.rb</a>
            (<a href="http://github.com/me/spider/tree/master/lib/spiderfw/controller/mixins/http_mixin.rb">view online</a>)
          </li>
        </ol>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>public class</h3>
            <ol>
              <li><a href="#M000739">included</a></li>
              <li><a href="#M000744">output_charset</a></li>
              <li><a href="#M000741">reverse_proxy_mapping</a></li>
            </ol>
            <h3>public instance</h3>
            <ol>
              <li><a href="#M000746">before</a></li>
              <li><a href="#M000748">challenge_basic_auth</a></li>
              <li><a href="#M000750">challenge_digest_auth</a></li>
              <li><a href="#M000749">check_basic_auth</a></li>
              <li><a href="#M000751">check_digest_auth</a></li>
              <li><a href="#M000745">content_type</a></li>
              <li><a href="#M000752">digest_instance_key</a></li>
              <li><a href="#M000754">http_auth_realm</a></li>
              <li><a href="#M000753">http_auth_realm=</a></li>
              <li><a href="#M000740">redirect</a></li>
              <li><a href="#M000742">request_path</a></li>
              <li><a href="#M000743">request_url</a></li>
              <li><a href="#M000747">try_rescue</a></li>
            </ol>
          </div>
          <div id='section'>
            <div id='class-list'>
              <h2>Classes and Modules</h2>
              Module <a href="HTTPMixin/ClassMethods.html" class="link">Spider::ControllerMixins::HTTPMixin::ClassMethods</a><br />
              Class <a href="HTTPMixin/HTTPStatus.html" class="link">Spider::ControllerMixins::HTTPMixin::HTTPStatus</a><br />
            </div>
            <div id='methods'>
              <h2>Public class methods</h2>
              <div class='public-class method' id='method-M000739'>
                <a name='M000739'>      </a>
                <div class='synopsis'>
                  <span class='name'>included</span>
                  <span class='arguments'>(klass)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000739-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000739-source'><span class="ruby-comment cmt"># File lib/spiderfw/controller/mixins/http_mixin.rb, line 10</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">included</span>(<span class="ruby-identifier">klass</span>)&#x000A;            <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">extend</span>(<span class="ruby-constant">ClassMethods</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000744'>
                <a name='M000744'>      </a>
                <div class='synopsis'>
                  <span class='name'>output_charset</span>
                  <span class='arguments'>(val)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000744-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000744-source'><span class="ruby-comment cmt"># File lib/spiderfw/controller/mixins/http_mixin.rb, line 41</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">output_charset</span>(<span class="ruby-identifier">val</span>)&#x000A;            <span class="ruby-ivar">@output_charset</span> = <span class="ruby-identifier">val</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">val</span>&#x000A;            <span class="ruby-ivar">@output_charset</span> <span class="ruby-operator">||</span> <span class="ruby-constant">Spider</span>.<span class="ruby-identifier">conf</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value str">'http.charset'</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000741'>
                <a name='M000741'>      </a>
                <div class='synopsis'>
                  <span class='name'>reverse_proxy_mapping</span>
                  <span class='arguments'>(url)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000741-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000741-source'><span class="ruby-comment cmt"># File lib/spiderfw/controller/mixins/http_mixin.rb, line 23</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">reverse_proxy_mapping</span>(<span class="ruby-identifier">url</span>)&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">''</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">url</span>&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">maps</span> = <span class="ruby-constant">Spider</span>.<span class="ruby-identifier">conf</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value str">'http.proxy_mapping'</span>))&#x000A;                <span class="ruby-identifier">maps</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">proxy</span>, <span class="ruby-identifier">spider</span><span class="ruby-operator">|</span>&#x000A;                    <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">proxy</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">url</span>[<span class="ruby-identifier">spider</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>] <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">spider</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">url</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-identifier">spider</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">spider</span>)&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">url</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <h2>Public instance methods</h2>
              <div class='public-instance method' id='method-M000746'>
                <a name='M000746'>      </a>
                <div class='synopsis'>
                  <span class='name'>before</span>
                  <span class='arguments'>(action='', *arguments)</span>
                </div>
                <div class='description'>
                  <p>
                  for widgets
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000746-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000746-source'><span class="ruby-comment cmt"># File lib/spiderfw/controller/mixins/http_mixin.rb, line 53</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">before</span>(<span class="ruby-identifier">action</span>=<span class="ruby-value str">''</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">arguments</span>)&#x000A;            <span class="ruby-comment cmt"># Redirect to url + slash if controller is called without action</span>&#x000A;            <span class="ruby-identifier">dest</span> = <span class="ruby-constant">HTTPMixin</span>.<span class="ruby-identifier">reverse_proxy_mapping</span>(<span class="ruby-ivar">@request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-value str">'PATH_INFO'</span>])&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">action</span> <span class="ruby-operator">==</span> <span class="ruby-value str">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">dest</span>[<span class="ruby-value">-1</span>].<span class="ruby-identifier">chr</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">'/'</span>)&#x000A;                <span class="ruby-identifier">dest</span> = <span class="ruby-identifier">dest</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">'/'</span>&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-ivar">@request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-value str">'QUERY_STRING'</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-value str">'QUERY_STRING'</span>].<span class="ruby-identifier">empty?</span>)&#x000A;                    <span class="ruby-identifier">dest</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">'?'</span><span class="ruby-operator">+</span><span class="ruby-ivar">@request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-value str">'QUERY_STRING'</span>]&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-identifier">redirect</span>(<span class="ruby-identifier">dest</span>)&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">super</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000748'>
                <a name='M000748'>      </a>
                <div class='synopsis'>
                  <span class='name'>challenge_basic_auth</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000748-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000748-source'><span class="ruby-comment cmt"># File lib/spiderfw/controller/mixins/http_mixin.rb, line 76</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">challenge_basic_auth</span>()&#x000A;            <span class="ruby-identifier">realm</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">http_auth_realm</span>&#x000A;            <span class="ruby-identifier">realm</span> <span class="ruby-operator">||=</span> <span class="ruby-value str">'Secure Area'</span>&#x000A;            <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-value str">&quot;WWW-Authenticate&quot;</span>] = <span class="ruby-node">&quot;Basic realm=\&quot;#{realm}\&quot;&quot;</span>&#x000A;            <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">status</span> = <span class="ruby-constant">Spider</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTP</span><span class="ruby-operator">::</span><span class="ruby-constant">UNAUTHORIZED</span>&#x000A;            <span class="ruby-identifier">render</span>(<span class="ruby-value str">'errors/unauthorized'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Visual</span>)&#x000A;            <span class="ruby-identifier">done</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000750'>
                <a name='M000750'>      </a>
                <div class='synopsis'>
                  <span class='name'>challenge_digest_auth</span>
                  <span class='arguments'>(realm=nil)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000750-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000750-source'><span class="ruby-comment cmt"># File lib/spiderfw/controller/mixins/http_mixin.rb, line 93</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">challenge_digest_auth</span>(<span class="ruby-identifier">realm</span>=<span class="ruby-keyword kw">nil</span>)&#x000A;            <span class="ruby-identifier">realm</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">http_auth_realm</span>&#x000A;            <span class="ruby-identifier">realm</span> <span class="ruby-operator">||=</span> <span class="ruby-value str">'Secure Area'</span>&#x000A;            &#x000A;            <span class="ruby-comment cmt"># nonce</span>&#x000A;            <span class="ruby-identifier">now</span> = <span class="ruby-value str">&quot;%012d&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">request_time</span>&#x000A;            <span class="ruby-identifier">pk</span>  = <span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">MD5</span>.<span class="ruby-identifier">hexdigest</span>(<span class="ruby-node">&quot;#{now}:#{digest_instance_key}&quot;</span>)[<span class="ruby-value">0</span>,<span class="ruby-value">32</span>]&#x000A;            <span class="ruby-identifier">nonce</span> = [<span class="ruby-identifier">now</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;:&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">pk</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">&quot;m*&quot;</span>).<span class="ruby-identifier">chop</span> <span class="ruby-comment cmt"># it has 60 length of chars.</span>&#x000A;            &#x000A;            <span class="ruby-identifier">opaque</span> = [<span class="ruby-constant">UUID</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">generate</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">&quot;m*&quot;</span>).<span class="ruby-identifier">chop</span>&#x000A;            <span class="ruby-identifier">header</span> = <span class="ruby-node">&quot;Digest realm=\&quot;#{realm}\&quot;, qop=\&quot;auth\&quot;, nonce=\&quot;#{nonce}\&quot;, opaque=\&quot;#{opaque}\&quot;&quot;</span>&#x000A;            <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-value str">'WWW-Authenticate'</span>] = <span class="ruby-identifier">header</span>&#x000A;            <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">status</span> = <span class="ruby-constant">Spider</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTP</span><span class="ruby-operator">::</span><span class="ruby-constant">UNAUTHORIZED</span>&#x000A;            <span class="ruby-identifier">done</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000749'>
                <a name='M000749'>      </a>
                <div class='synopsis'>
                  <span class='name'>check_basic_auth</span>
                  <span class='arguments'>(authenticator)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000749-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000749-source'><span class="ruby-comment cmt"># File lib/spiderfw/controller/mixins/http_mixin.rb, line 85</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_basic_auth</span>(<span class="ruby-identifier">authenticator</span>)&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-ivar">@request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-value str">'HTTP_AUTHORIZATION'</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/Basic (.+)/</span>)&#x000A;                <span class="ruby-identifier">pair</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span>(<span class="ruby-identifier">$1</span>)&#x000A;                <span class="ruby-identifier">user</span>, <span class="ruby-identifier">pass</span> = <span class="ruby-identifier">pair</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">':'</span>)&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">authenticator</span>.<span class="ruby-identifier">authenticate</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">pass</span>)&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000751'>
                <a name='M000751'>      </a>
                <div class='synopsis'>
                  <span class='name'>check_digest_auth</span>
                  <span class='arguments'>(authenticator)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000751-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000751-source'><span class="ruby-comment cmt"># File lib/spiderfw/controller/mixins/http_mixin.rb, line 109</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_digest_auth</span>(<span class="ruby-identifier">authenticator</span>)&#x000A;            <span class="ruby-comment cmt"># TODO: implement opaque, auth-int</span>&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-ivar">@request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-value str">'HTTP_AUTHORIZATION'</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/Digest (.+)/</span>)&#x000A;                <span class="ruby-identifier">parts</span> = <span class="ruby-identifier">$1</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">','</span>)&#x000A;                <span class="ruby-identifier">params</span> = {}&#x000A;                <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>&#x000A;                    <span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span> = <span class="ruby-identifier">p</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">'='</span>)&#x000A;                    <span class="ruby-identifier">v</span> = <span class="ruby-identifier">v</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp re">/^&quot;+/</span>, <span class="ruby-value str">''</span>).<span class="ruby-identifier">sub</span>(<span class="ruby-regexp re">/&quot;+$/</span>, <span class="ruby-value str">''</span>)&#x000A;                    <span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>.<span class="ruby-identifier">downcase</span>] = <span class="ruby-identifier">v</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;                [<span class="ruby-value str">'username'</span>, <span class="ruby-value str">'realm'</span>, <span class="ruby-value str">'nonce'</span>, <span class="ruby-value str">'uri'</span>, <span class="ruby-value str">'cnonce'</span>, <span class="ruby-value str">'qop'</span>, <span class="ruby-value str">'nc'</span>, <span class="ruby-value str">'response'</span>, <span class="ruby-value str">'opaque'</span>].<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>] }&#x000A;                <span class="ruby-identifier">pub_time</span>, <span class="ruby-identifier">pk</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value str">'nonce'</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">&quot;m*&quot;</span>)[<span class="ruby-value">0</span>].<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;:&quot;</span>, <span class="ruby-value">2</span>)&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">pub_time</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">pk</span>&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">MD5</span>.<span class="ruby-identifier">hexdigest</span>(<span class="ruby-node">&quot;#{pub_time}:#{digest_instance_key}&quot;</span>)[<span class="ruby-value">0</span>,<span class="ruby-value">32</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">pk</span>&#x000A;                <span class="ruby-identifier">diff_time</span> = <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">request_time</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">pub_time</span>.<span class="ruby-identifier">to_i</span>&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">diff_time</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">0</span>&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">diff_time</span> <span class="ruby-operator">&gt;</span> <span class="ruby-constant">Spider</span>.<span class="ruby-identifier">conf</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value str">'http.nonce_life'</span>)&#x000A;                <span class="ruby-identifier">user</span> = <span class="ruby-identifier">authenticator</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value str">'username'</span>], <span class="ruby-identifier">params</span>[<span class="ruby-value str">'realm'</span>])&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">user</span>&#x000A;                <span class="ruby-identifier">ha1</span> = <span class="ruby-identifier">user</span>.<span class="ruby-identifier">ha1</span>&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">ha1</span>&#x000A;                <span class="ruby-identifier">ha2</span> = <span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">MD5</span>.<span class="ruby-identifier">hexdigest</span>(<span class="ruby-node">&quot;#{@request.env['REQUEST_METHOD']}:#{params['uri']}&quot;</span>)&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value str">'qop'</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;auth&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value str">'qop'</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;auth-int&quot;</span>)&#x000A;                    <span class="ruby-identifier">param2</span> = [<span class="ruby-value str">'nonce'</span>, <span class="ruby-value str">'nc'</span>, <span class="ruby-value str">'cnonce'</span>, <span class="ruby-value str">'qop'</span>].<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">key</span>] }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">':'</span>)&#x000A;                    <span class="ruby-identifier">response</span> = <span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">MD5</span>.<span class="ruby-identifier">hexdigest</span>([<span class="ruby-identifier">ha1</span>, <span class="ruby-identifier">param2</span>, <span class="ruby-identifier">ha2</span>].<span class="ruby-identifier">join</span>(<span class="ruby-value str">':'</span>))&#x000A;                <span class="ruby-keyword kw">else</span>&#x000A;                    <span class="ruby-identifier">response</span> = <span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">MD5</span>.<span class="ruby-identifier">hexdigest</span>([<span class="ruby-identifier">ha1</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value str">'nonce'</span>], <span class="ruby-identifier">ha2</span>].<span class="ruby-identifier">join</span>(<span class="ruby-value str">':'</span>))&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">response</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">params</span>[<span class="ruby-value str">'response'</span>]&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">uid</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000745'>
                <a name='M000745'>      </a>
                <div class='synopsis'>
                  <span class='name'>content_type</span>
                  <span class='arguments'>(ct)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000745-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000745-source'><span class="ruby-comment cmt"># File lib/spiderfw/controller/mixins/http_mixin.rb, line 46</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">content_type</span>(<span class="ruby-identifier">ct</span>)&#x000A;            <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-value str">&quot;Content-Type&quot;</span>] = <span class="ruby-node">&quot;#{ct};charset=#{output_charset}&quot;</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000752'>
                <a name='M000752'>      </a>
                <div class='synopsis'>
                  <span class='name'>digest_instance_key</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000752-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000752-source'><span class="ruby-comment cmt"># File lib/spiderfw/controller/mixins/http_mixin.rb, line 142</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">digest_instance_key</span>&#x000A;            <span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">MD5</span>.<span class="ruby-identifier">hexdigest</span>(<span class="ruby-node">&quot;#{Mac.addr}:plaw15x857m4p671&quot;</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000754'>
                <a name='M000754'>      </a>
                <div class='synopsis'>
                  <span class='name'>http_auth_realm</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000754-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000754-source'><span class="ruby-comment cmt"># File lib/spiderfw/controller/mixins/http_mixin.rb, line 152</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">http_auth_realm</span>&#x000A;            <span class="ruby-ivar">@http_auth_realm</span> <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">http_auth_realm</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000753'>
                <a name='M000753'>      </a>
                <div class='synopsis'>
                  <span class='name'>http_auth_realm=</span>
                  <span class='arguments'>(val)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000753-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000753-source'><span class="ruby-comment cmt"># File lib/spiderfw/controller/mixins/http_mixin.rb, line 148</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">http_auth_realm=</span>(<span class="ruby-identifier">val</span>)&#x000A;            <span class="ruby-ivar">@http_auth_realm</span> = <span class="ruby-identifier">val</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000740'>
                <a name='M000740'>      </a>
                <div class='synopsis'>
                  <span class='name'>redirect</span>
                  <span class='arguments'>(url, code=Spider::HTTP::MOVED_PERMANENTLY)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000740-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000740-source'><span class="ruby-comment cmt"># File lib/spiderfw/controller/mixins/http_mixin.rb, line 14</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">redirect</span>(<span class="ruby-identifier">url</span>, <span class="ruby-identifier">code</span>=<span class="ruby-constant">Spider</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTP</span><span class="ruby-operator">::</span><span class="ruby-constant">MOVED_PERMANENTLY</span>)&#x000A;            <span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;REDIRECTING TO #{url}&quot;</span>&#x000A;            <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">status</span> = <span class="ruby-identifier">code</span>&#x000A;            <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-value str">&quot;Location&quot;</span>] = <span class="ruby-identifier">url</span>&#x000A;            <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">headers</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">&quot;Content-Type&quot;</span>)&#x000A;            <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">headers</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">&quot;Set-Cookie&quot;</span>)&#x000A;            <span class="ruby-identifier">done</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000742'>
                <a name='M000742'>      </a>
                <div class='synopsis'>
                  <span class='name'>request_path</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000742-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000742-source'><span class="ruby-comment cmt"># File lib/spiderfw/controller/mixins/http_mixin.rb, line 33</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">request_path</span>&#x000A;            <span class="ruby-constant">HTTPMixin</span>.<span class="ruby-identifier">reverse_proxy_mapping</span>(<span class="ruby-keyword kw">super</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000743'>
                <a name='M000743'>      </a>
                <div class='synopsis'>
                  <span class='name'>request_url</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000743-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000743-source'><span class="ruby-comment cmt"># File lib/spiderfw/controller/mixins/http_mixin.rb, line 37</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">request_url</span>&#x000A;            <span class="ruby-value str">'http://'</span><span class="ruby-operator">+</span><span class="ruby-ivar">@request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-value str">'HTTP_HOST'</span>]<span class="ruby-operator">+</span><span class="ruby-identifier">request_path</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000747'>
                <a name='M000747'>      </a>
                <div class='synopsis'>
                  <span class='name'>try_rescue</span>
                  <span class='arguments'>(exc)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000747-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000747-source'><span class="ruby-comment cmt"># File lib/spiderfw/controller/mixins/http_mixin.rb, line 66</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">try_rescue</span>(<span class="ruby-identifier">exc</span>)&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">exc</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">HTTPStatus</span>))&#x000A;                <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">status</span> = <span class="ruby-identifier">exc</span>.<span class="ruby-identifier">code</span>&#x000A;                <span class="ruby-identifier">done</span>&#x000A;                <span class="ruby-comment cmt">#raise</span>&#x000A;            <span class="ruby-keyword kw">else</span>&#x000A;                <span class="ruby-keyword kw">super</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
