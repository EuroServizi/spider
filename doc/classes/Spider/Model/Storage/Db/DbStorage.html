<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>: Spider::Model::Storage::Db::DbStorage [Spider documentation]</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../../../../../rdoc-style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>Class</span>
          Spider::Model::Storage::Db::DbStorage
        </h1>
        <ol class='paths'>
          <li>
            <a href="../../../../../files/lib/spiderfw/model/storage/db/db_storage_rb.html">lib/spiderfw/model/storage/db/db_storage.rb</a>
            (<a href="http://github.com/me/spider/tree/master/lib/spiderfw/model/storage/db/db_storage.rb">view online</a>)
          </li>
        </ol>
        <div class='parent'>
          Parent:
          <strong>Storage::BaseStorage</strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            <p>
            Represents a DB connection, and provides methods to execute structured
            queries on it. This is the class that generates the actual SQL; vendor
            specific extensions may override the generic SQL methods.
            </p>
          </div>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>public class</h3>
            <ol>
              <li><a href="#M000290">connection_alive?</a></li>
              <li><a href="#M000287">get_connection</a></li>
              <li><a href="#M000291">new</a></li>
              <li><a href="#M000286">new_connection</a></li>
              <li><a href="#M000288">release_connection</a></li>
              <li><a href="#M000289">remove_connection</a></li>
            </ol>
            <h3>public instance</h3>
            <ol>
              <li><a href="#M000331">alter_table</a></li>
              <li><a href="#M000308">column_attributes</a></li>
              <li><a href="#M000306">column_name</a></li>
              <li><a href="#M000307">column_type</a></li>
              <li><a href="#M000301">commit</a></li>
              <li><a href="#M000292">connect</a></li>
              <li><a href="#M000293">connected?</a></li>
              <li><a href="#M000294">connection</a></li>
              <li><a href="#M000330">create_table</a></li>
              <li><a href="#M000343">describe_table</a></li>
              <li><a href="#M000295">disconnect</a></li>
              <li><a href="#M000332">drop_field</a></li>
              <li><a href="#M000333">drop_table</a></li>
              <li><a href="#M000309">function</a></li>
              <li><a href="#M000296">get_mapper</a></li>
              <li><a href="#M000300">in_transaction?</a></li>
              <li><a href="#M000342">list_tables</a></li>
              <li><a href="#M000303">lock</a></li>
              <li><a href="#M000313">prepare_value</a></li>
              <li><a href="#M000314">query</a></li>
              <li><a href="#M000302">rollback</a></li>
              <li><a href="#M000340">safe_schema_conversion?</a></li>
              <li><a href="#M000339">schema_field_equal?</a></li>
              <li><a href="#M000305">sequence_name</a></li>
              <li><a href="#M000341">shorten_identifier</a></li>
              <li><a href="#M000335">sql_add_field</a></li>
              <li><a href="#M000336">sql_alter_field</a></li>
              <li><a href="#M000329">sql_alter_table</a></li>
              <li><a href="#M000319">sql_condition</a></li>
              <li><a href="#M000320">sql_condition_value</a></li>
              <li><a href="#M000328">sql_create_table</a></li>
              <li><a href="#M000327">sql_delete</a></li>
              <li><a href="#M000337">sql_drop_field</a></li>
              <li><a href="#M000338">sql_drop_table</a></li>
              <li><a href="#M000324">sql_insert</a></li>
              <li><a href="#M000321">sql_joins</a></li>
              <li><a href="#M000316">sql_keys</a></li>
              <li><a href="#M000323">sql_limit</a></li>
              <li><a href="#M000322">sql_order</a></li>
              <li><a href="#M000315">sql_select</a></li>
              <li><a href="#M000334">sql_table_field</a></li>
              <li><a href="#M000317">sql_tables</a></li>
              <li><a href="#M000318">sql_tables_join</a></li>
              <li><a href="#M000325">sql_update</a></li>
              <li><a href="#M000326">sql_update_values</a></li>
              <li><a href="#M000299">start_transaction</a></li>
              <li><a href="#M000297">supports?</a></li>
              <li><a href="#M000298">supports_transactions?</a></li>
              <li><a href="#M000304">table_name</a></li>
              <li><a href="#M000311">value_for_condition</a></li>
              <li><a href="#M000310">value_for_save</a></li>
              <li><a href="#M000312">value_to_mapper</a></li>
            </ol>
          </div>
          <div id='section'>
            <div id='attribute-list'>
              <h2 class='section-bar'>Attributes</h2>
              <div class='name-list'>
                <table>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>capabilities</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      An Hash of DB capabilities. The default is {:autoincrement => false,
                      :sequences => true, :transactions => true} (The <a
                      href="../BaseStorage.html">BaseStorage</a> class provides file sequences in
                      case the subclass does not support them.)
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>reserved_keywords</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      An Array of keywords that can not be used in schema names.
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>safe_conversions</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      <a href="../../Type.html">Type</a> conversions which do not lose data. See
                      also <a href="DbStorage.html#M000340">safe_schema_conversion?</a>
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>type_synonyms</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      An Hash of DB type equivalents.
                    </td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='methods'>
              <h2>Public class methods</h2>
              <div class='public-class method' id='method-M000290'>
                <a name='M000290'>      </a>
                <div class='synopsis'>
                  <span class='name'>connection_alive?</span>
                  <span class='arguments'>(conn)</span>
                </div>
                <div class='description'>
                  <p>
                  Checks whether a connection is still alive. Must be implemented by
                  subclasses.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000290-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000290-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 115</span>&#x000A;            <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">connection_alive?</span>(<span class="ruby-identifier">conn</span>)&#x000A;                <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Virtual&quot;</span>&#x000A;            <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000287'>
                <a name='M000287'>      </a>
                <div class='synopsis'>
                  <span class='name'>get_connection</span>
                  <span class='arguments'>(*args)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns a connection, drawing from the pool or instantiating a new one.
                  Arguments are passed to the <a
                  href="DbStorage.html#M000286">new_connection</a> method. Pool size is
                  configured with &#8216;storage.db.pool.size&#8217;.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000287-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000287-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 44</span>&#x000A;            <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_connection</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)&#x000A;                <span class="ruby-ivar">@connection_semaphore</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Mutex</span>.<span class="ruby-identifier">new</span>&#x000A;                <span class="ruby-ivar">@connections</span> <span class="ruby-operator">||=</span> {}&#x000A;                <span class="ruby-ivar">@free_connections</span> <span class="ruby-operator">||=</span> {}&#x000A;                <span class="ruby-identifier">max_connections</span> = <span class="ruby-constant">Spider</span>.<span class="ruby-identifier">conf</span>.<span class="ruby-identifier">get</span>(<span class="ruby-value str">'storage.db.pool.size'</span>)&#x000A;                &#x000A;                <span class="ruby-identifier">conn</span> = <span class="ruby-keyword kw">nil</span>&#x000A;                <span class="ruby-identifier">connect_exception</span> = <span class="ruby-keyword kw">nil</span>&#x000A;                <span class="ruby-ivar">@connection_semaphore</span>.<span class="ruby-identifier">synchronize</span>{&#x000A;                    <span class="ruby-ivar">@free_connections</span>[<span class="ruby-identifier">args</span>] <span class="ruby-operator">||=</span> []&#x000A;                    <span class="ruby-ivar">@connections</span>[<span class="ruby-identifier">args</span>] <span class="ruby-operator">||=</span> []&#x000A;                    <span class="ruby-identifier">keep_trying</span> = <span class="ruby-keyword kw">true</span>&#x000A;                    <span class="ruby-keyword kw">while</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">conn</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">keep_trying</span>)&#x000A;                        <span class="ruby-keyword kw">if</span> (<span class="ruby-ivar">@free_connections</span>[<span class="ruby-identifier">args</span>].<span class="ruby-identifier">empty?</span>)&#x000A;                            <span class="ruby-comment cmt">#Spider::Logger.debug(&quot;NO FREE CONNECTION&quot;)</span>&#x000A;                            <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@connections</span>[<span class="ruby-identifier">args</span>].<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">max_connections</span>&#x000A;                                <span class="ruby-keyword kw">begin</span>&#x000A;                                    <span class="ruby-identifier">conn</span> = <span class="ruby-identifier">new_connection</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)&#x000A;                                    <span class="ruby-ivar">@connections</span>[<span class="ruby-identifier">args</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">conn</span>&#x000A;                                <span class="ruby-keyword kw">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">exc</span>&#x000A;                                    <span class="ruby-identifier">connect_exception</span> = <span class="ruby-identifier">exc</span>&#x000A;                                    <span class="ruby-identifier">keep_trying</span> = <span class="ruby-keyword kw">false</span>&#x000A;                                <span class="ruby-keyword kw">end</span>&#x000A;                                <span class="ruby-comment cmt">#Spider::Logger.debug(&quot;CREATED NEW CONNECTION #{conn}&quot;)</span>&#x000A;                            <span class="ruby-keyword kw">else</span>&#x000A;                                <span class="ruby-identifier">sleep_cnt</span> = <span class="ruby-value">0</span>&#x000A;                                <span class="ruby-keyword kw">while</span> <span class="ruby-ivar">@free_connections</span>[<span class="ruby-identifier">args</span>].<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">sleep_cnt</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">10000</span>&#x000A;                                    <span class="ruby-identifier">sleep</span>(<span class="ruby-value">0</span><span class="ruby-value">.001</span>)&#x000A;                                    <span class="ruby-identifier">sleep_cnt</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>&#x000A;                                <span class="ruby-keyword kw">end</span>&#x000A;                                <span class="ruby-identifier">keep_trying</span> = <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sleep_cnt</span> <span class="ruby-operator">==</span> <span class="ruby-value">10000</span>&#x000A;                                <span class="ruby-comment cmt">#Spider::Logger.debug(&quot;WAITED FOR FREE CONNECTION, GOT #{@free_connections[args].last}&quot;)</span>&#x000A;                            <span class="ruby-keyword kw">end</span>&#x000A;                        <span class="ruby-keyword kw">end</span>&#x000A;                        <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">conn</span>&#x000A;                            <span class="ruby-keyword kw">while</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">conn</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@free_connections</span>[<span class="ruby-identifier">args</span>].<span class="ruby-identifier">empty?</span>)&#x000A;                                <span class="ruby-identifier">conn</span> = <span class="ruby-ivar">@free_connections</span>[<span class="ruby-identifier">args</span>].<span class="ruby-identifier">pop</span>&#x000A;                                <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">connection_alive?</span>(<span class="ruby-identifier">conn</span>)&#x000A;                                    <span class="ruby-identifier">remove_connection_nosync</span>(<span class="ruby-identifier">conn</span>, <span class="ruby-identifier">args</span>)&#x000A;                                    <span class="ruby-identifier">conn</span> = <span class="ruby-keyword kw">nil</span>&#x000A;                                <span class="ruby-keyword kw">end</span>&#x000A;                            <span class="ruby-keyword kw">end</span>&#x000A;                        <span class="ruby-keyword kw">end</span>&#x000A;                    <span class="ruby-keyword kw">end</span>&#x000A;                    <span class="ruby-comment cmt">#Spider::Logger.debug(&quot;GOT CONNECTION #{args}&quot;)</span>&#x000A;                    &#x000A;                }&#x000A;                <span class="ruby-identifier">raise</span> <span class="ruby-identifier">connect_exception</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">connect_exception</span>&#x000A;                <span class="ruby-identifier">raise</span> <span class="ruby-constant">StorageException</span>, <span class="ruby-value str">&quot;Unable to get a connection&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">conn</span>&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">conn</span>&#x000A;            <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000291'>
                <a name='M000291'>      </a>
                <div class='synopsis'>
                  <span class='name'>new</span>
                  <span class='arguments'>(url)</span>
                </div>
                <div class='description'>
                  <p>
                  The constructor takes the connection URL, which will be parsed into
                  connection params.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000291-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000291-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 122</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">url</span>)&#x000A;            <span class="ruby-keyword kw">super</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000286'>
                <a name='M000286'>      </a>
                <div class='synopsis'>
                  <span class='name'>new_connection</span>
                  <span class='arguments'>(*args)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns a new connection. Must be implemented by the subclasses; args are
                  implementation specific.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000286-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000286-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 38</span>&#x000A;            <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">new_connection</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)&#x000A;            <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000288'>
                <a name='M000288'>      </a>
                <div class='synopsis'>
                  <span class='name'>release_connection</span>
                  <span class='arguments'>(conn, conn_params)</span>
                </div>
                <div class='description'>
                  <p>
                  Frees a connection, relasing it to the pool
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000288-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000288-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 97</span>&#x000A;            <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">release_connection</span>(<span class="ruby-identifier">conn</span>, <span class="ruby-identifier">conn_params</span>)&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">conn</span>&#x000A;                <span class="ruby-ivar">@free_connections</span>[<span class="ruby-identifier">conn_params</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">conn</span>&#x000A;            <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000289'>
                <a name='M000289'>      </a>
                <div class='synopsis'>
                  <span class='name'>remove_connection</span>
                  <span class='arguments'>(conn, conn_params)</span>
                </div>
                <div class='description'>
                  <p>
                  Removes a connection from the pool.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000289-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000289-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 103</span>&#x000A;            <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_connection</span>(<span class="ruby-identifier">conn</span>, <span class="ruby-identifier">conn_params</span>)&#x000A;                <span class="ruby-ivar">@connection_semaphore</span>.<span class="ruby-identifier">synchronize</span>{&#x000A;                    <span class="ruby-identifier">remove_connection_nosync</span>(<span class="ruby-identifier">conn</span>, <span class="ruby-identifier">conn_params</span>)&#x000A;                }&#x000A;            <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <h2>Public instance methods</h2>
              <div class='public-instance method' id='method-M000331'>
                <a name='M000331'>      </a>
                <div class='synopsis'>
                  <span class='name'>alter_table</span>
                  <span class='arguments'>(alter)</span>
                </div>
                <div class='description'>
                  <p>
                  Executes an alter table structured description.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000331-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000331-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 581</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">alter_table</span>(<span class="ruby-identifier">alter</span>)&#x000A;            <span class="ruby-identifier">sqls</span> = <span class="ruby-identifier">sql_alter_table</span>(<span class="ruby-identifier">alter</span>)&#x000A;            <span class="ruby-identifier">sqls</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sql</span><span class="ruby-operator">|</span>&#x000A;                <span class="ruby-identifier">execute</span>(<span class="ruby-identifier">sql</span>)&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000308'>
                <a name='M000308'>      </a>
                <div class='synopsis'>
                  <span class='name'>column_attributes</span>
                  <span class='arguments'>(type, attributes)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns the attributes corresponding to element type and attributes
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000308-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000308-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 251</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">column_attributes</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">attributes</span>)&#x000A;            <span class="ruby-identifier">db_attributes</span> = {}&#x000A;            <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">type</span>.<span class="ruby-identifier">name</span>&#x000A;            <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'String'</span>, <span class="ruby-value str">'Spider::DataTypes::Text'</span>&#x000A;                <span class="ruby-identifier">db_attributes</span>[<span class="ruby-identifier">:length</span>] = <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:length</span>] <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:length</span>])&#x000A;            <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'Float'</span>&#x000A;                <span class="ruby-identifier">db_attributes</span>[<span class="ruby-identifier">:length</span>] = <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:length</span>] <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:length</span>])&#x000A;                <span class="ruby-identifier">db_attributes</span>[<span class="ruby-identifier">:precision</span>] = <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:precision</span>] <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:precision</span>])&#x000A;            <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'BigDecimal'</span>&#x000A;                <span class="ruby-identifier">db_attributes</span>[<span class="ruby-identifier">:precision</span>] = <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:precision</span>] <span class="ruby-operator">||</span> <span class="ruby-value">65</span>&#x000A;                <span class="ruby-identifier">db_attributes</span>[<span class="ruby-identifier">:scale</span>] = <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:scale</span>] <span class="ruby-operator">||</span> <span class="ruby-value">2</span>&#x000A;            <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'Spider::DataTypes::Binary'</span>&#x000A;                <span class="ruby-identifier">db_attributes</span>[<span class="ruby-identifier">:length</span>] = <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:length</span>] <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:length</span>])&#x000A;            <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'Spider::DataTypes::Bool'</span>&#x000A;                <span class="ruby-identifier">db_attributes</span>[<span class="ruby-identifier">:length</span>] = <span class="ruby-value">1</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-identifier">db_attributes</span>[<span class="ruby-identifier">:autoincrement</span>] = <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:autoincrement</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">supports?</span>(<span class="ruby-identifier">:autoincrement</span>)&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">db_attributes</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000306'>
                <a name='M000306'>      </a>
                <div class='synopsis'>
                  <span class='name'>column_name</span>
                  <span class='arguments'>(name)</span>
                </div>
                <div class='description'>
                  <p>
                  Fixes a string to be used as a column name.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000306-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000306-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 222</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">column_name</span>(<span class="ruby-identifier">name</span>)&#x000A;            <span class="ruby-identifier">name</span> = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>&#x000A;            <span class="ruby-identifier">name</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">'_field'</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">reserved_keywords</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">name</span>.<span class="ruby-identifier">downcase</span>)) &#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">name</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000307'>
                <a name='M000307'>      </a>
                <div class='synopsis'>
                  <span class='name'>column_type</span>
                  <span class='arguments'>(type, attributes)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns the db type corresponding to an element type.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000307-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000307-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 229</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">column_type</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">attributes</span>)&#x000A;            <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">type</span>.<span class="ruby-identifier">name</span>&#x000A;            <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'String'</span>&#x000A;                <span class="ruby-value str">'TEXT'</span>&#x000A;            <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'Text'</span>&#x000A;                <span class="ruby-value str">'LONGTEXT'</span>&#x000A;            <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'Fixnum'</span>&#x000A;                <span class="ruby-value str">'INT'</span>&#x000A;            <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'Float'</span>&#x000A;                <span class="ruby-value str">'REAL'</span>&#x000A;            <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'BigDecimal'</span>, <span class="ruby-value str">'Spider::DataTypes::Decimal'</span>&#x000A;                <span class="ruby-value str">'DECIMAL'</span>&#x000A;            <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'Date'</span>, <span class="ruby-value str">'DateTime'</span>&#x000A;                <span class="ruby-value str">'DATE'</span>&#x000A;            <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'Spider::DataTypes::Binary'</span>&#x000A;                <span class="ruby-value str">'BLOB'</span>&#x000A;            <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'Spider::DataTypes::Bool'</span>&#x000A;                <span class="ruby-value str">'INT'</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000301'>
                <a name='M000301'>      </a>
                <div class='synopsis'>
                  <span class='name'>commit</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000301-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000301-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 188</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">commit</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000292'>
                <a name='M000292'>      </a>
                <div class='synopsis'>
                  <span class='name'>connect</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Instantiates a new connection with current connection params.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000292-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000292-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 127</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">connect</span>()&#x000A;            <span class="ruby-ivar">@conn</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">get_connection</span>(<span class="ruby-operator">*</span><span class="ruby-ivar">@connection_params</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000293'>
                <a name='M000293'>      </a>
                <div class='synopsis'>
                  <span class='name'>connected?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  True if currently connected.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000293-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000293-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 132</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">connected?</span>&#x000A;            <span class="ruby-ivar">@conn</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000294'>
                <a name='M000294'>      </a>
                <div class='synopsis'>
                  <span class='name'>connection</span>
                  <span class='arguments'>() {|@conn| ...}</span>
                </div>
                <div class='description'>
                  <p>
                  Returns the current connection, or creates a new one. If a block is given,
                  will disconnect after yielding.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000294-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000294-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 138</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">connection</span>&#x000A;            <span class="ruby-identifier">is_connected</span> = <span class="ruby-identifier">connected?</span>&#x000A;            <span class="ruby-identifier">connect</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">is_connected</span>&#x000A;            <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>&#x000A;                <span class="ruby-keyword kw">yield</span> <span class="ruby-ivar">@conn</span>&#x000A;                <span class="ruby-identifier">disconnect</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">is_connected</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@conn</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000330'>
                <a name='M000330'>      </a>
                <div class='synopsis'>
                  <span class='name'>create_table</span>
                  <span class='arguments'>(create)</span>
                </div>
                <div class='description'>
                  <p>
                  Executes a create table structured description.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000330-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000330-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 573</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_table</span>(<span class="ruby-identifier">create</span>)&#x000A;            <span class="ruby-identifier">sqls</span> = <span class="ruby-identifier">sql_create_table</span>(<span class="ruby-identifier">create</span>)&#x000A;            <span class="ruby-identifier">sqls</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sql</span><span class="ruby-operator">|</span>&#x000A;                <span class="ruby-identifier">execute</span>(<span class="ruby-identifier">sql</span>)&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000343'>
                <a name='M000343'>      </a>
                <div class='synopsis'>
                  <span class='name'>describe_table</span>
                  <span class='arguments'>(table)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns a description of the table as currently present in the DB.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000343-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000343-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 695</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">describe_table</span>(<span class="ruby-identifier">table</span>)&#x000A;            <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Unimplemented&quot;</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000295'>
                <a name='M000295'>      </a>
                <div class='synopsis'>
                  <span class='name'>disconnect</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Releases the current connection to the pool.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000295-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000295-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 149</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">disconnect</span>&#x000A;            <span class="ruby-comment cmt"># The subclass should check if the connection is alive, and if it is not call remove_connection instead</span>&#x000A;            <span class="ruby-keyword kw">begin</span>&#x000A;                <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">release_connection</span>(<span class="ruby-ivar">@conn</span>, <span class="ruby-ivar">@connection_params</span>)&#x000A;            <span class="ruby-keyword kw">ensure</span>&#x000A;                <span class="ruby-ivar">@conn</span> = <span class="ruby-keyword kw">nil</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>&#x000A;            <span class="ruby-comment cmt">#@conn = nil</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000332'>
                <a name='M000332'>      </a>
                <div class='synopsis'>
                  <span class='name'>drop_field</span>
                  <span class='arguments'>(table_name, field_name)</span>
                </div>
                <div class='description'>
                  <p>
                  Drops a field from the DB.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000332-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000332-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 589</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">drop_field</span>(<span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">field_name</span>)&#x000A;            <span class="ruby-identifier">sqls</span> = <span class="ruby-identifier">sql_drop_field</span>(<span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">field_name</span>)&#x000A;            <span class="ruby-identifier">sqls</span>.<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">sql</span><span class="ruby-operator">|</span> <span class="ruby-identifier">execute</span>(<span class="ruby-identifier">sql</span>) }&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000333'>
                <a name='M000333'>      </a>
                <div class='synopsis'>
                  <span class='name'>drop_table</span>
                  <span class='arguments'>(table_name)</span>
                </div>
                <div class='description'>
                  <p>
                  Drops a table from the DB.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000333-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000333-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 595</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">drop_table</span>(<span class="ruby-identifier">table_name</span>)&#x000A;            <span class="ruby-identifier">sqls</span> = <span class="ruby-identifier">sql_drop_table</span>(<span class="ruby-identifier">table_name</span>)&#x000A;            <span class="ruby-identifier">sqls</span>.<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">sql</span><span class="ruby-operator">|</span> <span class="ruby-identifier">execute</span>(<span class="ruby-identifier">sql</span>) }&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000309'>
                <a name='M000309'>      </a>
                <div class='synopsis'>
                  <span class='name'>function</span>
                  <span class='arguments'>(func)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns the SQL for a <a
                  href="../../../QueryFuncs/Function.html">QueryFuncs::Function</a>
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000309-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000309-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 272</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">function</span>(<span class="ruby-identifier">func</span>)&#x000A;            <span class="ruby-identifier">fields</span> = <span class="ruby-identifier">func</span>.<span class="ruby-identifier">elements</span>.<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">func_el</span><span class="ruby-operator">|</span>&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">func_el</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Spider</span><span class="ruby-operator">::</span><span class="ruby-constant">QueryFuncs</span><span class="ruby-operator">::</span><span class="ruby-constant">Function</span>))&#x000A;                    <span class="ruby-identifier">function</span>(<span class="ruby-identifier">func_el</span>)&#x000A;                <span class="ruby-keyword kw">else</span>&#x000A;                    <span class="ruby-identifier">func</span>.<span class="ruby-identifier">mapper_fields</span>[<span class="ruby-identifier">func_el</span>]&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">', '</span>)&#x000A;            <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">func</span>.<span class="ruby-identifier">func_name</span>&#x000A;            <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:length</span>&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-node">&quot;LENGTH(#{fields})&quot;</span>&#x000A;            <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:trim</span>&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-node">&quot;TRIM(#{fields})&quot;</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-identifier">raise</span> <span class="ruby-constant">NotImplementedError</span>, <span class="ruby-node">&quot;#{self.class} does not support function #{type}&quot;</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000296'>
                <a name='M000296'>      </a>
                <div class='synopsis'>
                  <span class='name'>get_mapper</span>
                  <span class='arguments'>(model)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns the default mapper for the storage. If the storage subclass
                  contains a MapperExtension module, it will be mixed-in with the mapper.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000296-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000296-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 162</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_mapper</span>(<span class="ruby-identifier">model</span>)&#x000A;            <span class="ruby-identifier">mapper</span> = <span class="ruby-constant">Spider</span><span class="ruby-operator">::</span><span class="ruby-constant">Model</span><span class="ruby-operator">::</span><span class="ruby-constant">Mappers</span><span class="ruby-operator">::</span><span class="ruby-constant">DbMapper</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">model</span>, <span class="ruby-keyword kw">self</span>)&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">const_defined?</span>(<span class="ruby-identifier">:MapperExtension</span>))&#x000A;                <span class="ruby-identifier">mapper</span>.<span class="ruby-identifier">extend</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">const_get</span>(<span class="ruby-identifier">:MapperExtension</span>))&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">mapper</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000300'>
                <a name='M000300'>      </a>
                <div class='synopsis'>
                  <span class='name'>in_transaction?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000300-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000300-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 184</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">in_transaction?</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000342'>
                <a name='M000342'>      </a>
                <div class='synopsis'>
                  <span class='name'>list_tables</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns an array of the table names currently in the DB.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000342-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000342-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 690</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list_tables</span>&#x000A;            <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Unimplemented&quot;</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000303'>
                <a name='M000303'>      </a>
                <div class='synopsis'>
                  <span class='name'>lock</span>
                  <span class='arguments'>(table, mode=:exclusive)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000303-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000303-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 195</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">lock</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">mode</span>=<span class="ruby-identifier">:exclusive</span>)&#x000A;            <span class="ruby-identifier">lockmode</span> = <span class="ruby-keyword kw">case</span>(<span class="ruby-identifier">mode</span>)&#x000A;            <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:shared</span>&#x000A;                <span class="ruby-value str">'SHARE'</span>&#x000A;            <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:row_exclusive</span>&#x000A;                <span class="ruby-value str">'ROW EXCLUSIVE'</span>&#x000A;            <span class="ruby-keyword kw">else</span>&#x000A;                <span class="ruby-value str">'EXCLUSIVE'</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-identifier">execute</span>(<span class="ruby-node">&quot;LOCK TABLE #{table} IN #{lockmode} MODE&quot;</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000313'>
                <a name='M000313'>      </a>
                <div class='synopsis'>
                  <span class='name'>prepare_value</span>
                  <span class='arguments'>(type, value)</span>
                </div>
                <div class='description'>
                  <p>
                  Prepares a value that will be used on the DB.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000313-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000313-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 319</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">prepare_value</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">value</span>)&#x000A;            <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">type</span>.<span class="ruby-identifier">name</span>&#x000A;            <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'String'</span>, <span class="ruby-value str">'Spider::DataTypes::Text'</span>&#x000A;                <span class="ruby-identifier">enc</span> = <span class="ruby-ivar">@configuration</span>[<span class="ruby-value str">'encoding'</span>]&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">enc</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">enc</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">'utf-8'</span>)&#x000A;                    <span class="ruby-keyword kw">begin</span>&#x000A;                        <span class="ruby-identifier">value</span> = <span class="ruby-constant">Iconv</span>.<span class="ruby-identifier">conv</span>(<span class="ruby-identifier">enc</span><span class="ruby-operator">+</span><span class="ruby-value str">'//IGNORE'</span>, <span class="ruby-value str">'utf-8'</span>, <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_s</span>)&#x000A;                    <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Iconv</span><span class="ruby-operator">::</span><span class="ruby-constant">InvalidCharacter</span>&#x000A;                        <span class="ruby-identifier">value</span> = <span class="ruby-value str">''</span>&#x000A;                    <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'BigDecimal'</span>&#x000A;                <span class="ruby-identifier">value</span> = <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_f</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">value</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000314'>
                <a name='M000314'>      </a>
                <div class='synopsis'>
                  <span class='name'>query</span>
                  <span class='arguments'>(query)</span>
                </div>
                <div class='description'>
                  <p>
                  Executes a select query (given in struct form).
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000314-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000314-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 337</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">query</span>(<span class="ruby-identifier">query</span>)&#x000A;            <span class="ruby-ivar">@last_query</span> = <span class="ruby-identifier">query</span>&#x000A;            <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">query</span>[<span class="ruby-identifier">:query_type</span>]&#x000A;            <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:select</span>&#x000A;                <span class="ruby-identifier">sql</span>, <span class="ruby-identifier">bind_vars</span> = <span class="ruby-identifier">sql_select</span>(<span class="ruby-identifier">query</span>)&#x000A;                <span class="ruby-identifier">execute</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">bind_vars</span>)&#x000A;            <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:count</span>&#x000A;                <span class="ruby-identifier">query</span>[<span class="ruby-identifier">:keys</span>] = [<span class="ruby-value str">'COUNT(*) AS N'</span>]&#x000A;                <span class="ruby-identifier">sql</span>, <span class="ruby-identifier">bind_vars</span> = <span class="ruby-identifier">sql_select</span>(<span class="ruby-identifier">query</span>)&#x000A;                <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">execute</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">bind_vars</span>)[<span class="ruby-value">0</span>][<span class="ruby-value str">'N'</span>].<span class="ruby-identifier">to_i</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000302'>
                <a name='M000302'>      </a>
                <div class='synopsis'>
                  <span class='name'>rollback</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000302-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000302-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 191</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rollback</span>&#x000A;            <span class="ruby-identifier">raise</span> <span class="ruby-constant">StorageException</span>, <span class="ruby-value str">&quot;The current storage does not support transactions&quot;</span> &#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000340'>
                <a name='M000340'>      </a>
                <div class='synopsis'>
                  <span class='name'>safe_schema_conversion?</span>
                  <span class='arguments'>(current, field)</span>
                </div>
                <div class='description'>
                  <p>
                  Checks if the conversion from a current DB field to a schema field is safe,
                  i.e. can be done without loss of data.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000340-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000340-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 653</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">safe_schema_conversion?</span>(<span class="ruby-identifier">current</span>, <span class="ruby-identifier">field</span>)&#x000A;            <span class="ruby-identifier">attributes</span> = <span class="ruby-identifier">field</span>[<span class="ruby-identifier">:attributes</span>]&#x000A;            <span class="ruby-identifier">safe</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">safe_conversions</span>&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">current</span>[<span class="ruby-identifier">:type</span>] <span class="ruby-operator">!=</span> <span class="ruby-identifier">field</span>[<span class="ruby-identifier">:type</span>])&#x000A;                <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">safe</span>[<span class="ruby-identifier">current</span>[<span class="ruby-identifier">:type</span>]] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">safe</span>[<span class="ruby-identifier">current</span>[<span class="ruby-identifier">:type</span>]].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">field</span>[<span class="ruby-identifier">:type</span>])&#x000A;                    <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span> &#x000A;                <span class="ruby-keyword kw">else</span>&#x000A;                    <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> ((<span class="ruby-operator">!</span><span class="ruby-identifier">current</span>[<span class="ruby-identifier">:length</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">current</span>[<span class="ruby-identifier">:length</span>] <span class="ruby-operator">==</span> <span class="ruby-value">0</span>) \&#x000A;                            <span class="ruby-operator">||</span> (<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:length</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">current</span>[<span class="ruby-identifier">:length</span>] <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:length</span>])) <span class="ruby-operator">&amp;&amp;</span> \&#x000A;                           ((<span class="ruby-operator">!</span><span class="ruby-identifier">current</span>[<span class="ruby-identifier">:precision</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">current</span>[<span class="ruby-identifier">:precision</span>] <span class="ruby-operator">==</span> <span class="ruby-value">0</span>) \&#x000A;                           <span class="ruby-operator">||</span> (<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:precision</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">current</span>[<span class="ruby-identifier">:precision</span>] <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:precision</span>]))&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000339'>
                <a name='M000339'>      </a>
                <div class='synopsis'>
                  <span class='name'>schema_field_equal?</span>
                  <span class='arguments'>(current, field)</span>
                </div>
                <div class='description'>
                  <p>
                  Checks if a DB field is equal to a schema field.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000339-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000339-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 638</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">schema_field_equal?</span>(<span class="ruby-identifier">current</span>, <span class="ruby-identifier">field</span>)&#x000A;            <span class="ruby-identifier">attributes</span> = <span class="ruby-identifier">field</span>[<span class="ruby-identifier">:attributes</span>]&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">current</span>[<span class="ruby-identifier">:type</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">field</span>[<span class="ruby-identifier">:type</span>] <span class="ruby-operator">||</span> &#x000A;                (<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">type_synonyms</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">type_synonyms</span>[<span class="ruby-identifier">current</span>[<span class="ruby-identifier">:type</span>]] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">type_synonyms</span>[<span class="ruby-identifier">current</span>[<span class="ruby-identifier">:type</span>]].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">field</span>[<span class="ruby-identifier">:type</span>]))&#x000A;            <span class="ruby-identifier">try_method</span> = <span class="ruby-identifier">:&quot;schema_field_#{field[:type].downcase}_equal?&quot;</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">send</span>(<span class="ruby-identifier">try_method</span>, <span class="ruby-identifier">current</span>, <span class="ruby-identifier">field</span>) <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">try_method</span>))&#x000A;            <span class="ruby-identifier">current</span>[<span class="ruby-identifier">:length</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">0</span>; <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:length</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">0</span>; <span class="ruby-identifier">current</span>[<span class="ruby-identifier">:precision</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">0</span>; <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:precision</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">0</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">current</span>[<span class="ruby-identifier">:length</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:length</span>]&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">current</span>[<span class="ruby-identifier">:precision</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:precision</span>]&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000305'>
                <a name='M000305'>      </a>
                <div class='synopsis'>
                  <span class='name'>sequence_name</span>
                  <span class='arguments'>(name)</span>
                </div>
                <div class='description'>
                  <p>
                  Fixes a string to be used as a sequence name.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000305-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000305-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 217</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sequence_name</span>(<span class="ruby-identifier">name</span>)&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">':'</span>, <span class="ruby-value str">'_'</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000341'>
                <a name='M000341'>      </a>
                <div class='synopsis'>
                  <span class='name'>shorten_identifier</span>
                  <span class='arguments'>(name, length)</span>
                </div>
                <div class='description'>
                  <p>
                  Shortens a DB name up to length.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000341-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000341-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 671</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">shorten_identifier</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">length</span>)&#x000A;            <span class="ruby-keyword kw">while</span> (<span class="ruby-identifier">name</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">length</span>)&#x000A;                <span class="ruby-identifier">parts</span> = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">'_'</span>)&#x000A;                <span class="ruby-identifier">max</span> = <span class="ruby-value">0</span>&#x000A;                <span class="ruby-identifier">max_i</span> = <span class="ruby-keyword kw">nil</span>&#x000A;                <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">each_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>&#x000A;                    <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">parts</span>[<span class="ruby-identifier">i</span>].<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">max</span>)&#x000A;                        <span class="ruby-identifier">max</span> = <span class="ruby-identifier">parts</span>[<span class="ruby-identifier">i</span>].<span class="ruby-identifier">length</span>&#x000A;                        <span class="ruby-identifier">max_i</span> = <span class="ruby-identifier">i</span>&#x000A;                    <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-identifier">parts</span>[<span class="ruby-identifier">max_i</span>] = <span class="ruby-identifier">parts</span>[<span class="ruby-identifier">max_i</span>][<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">-2</span>]&#x000A;                <span class="ruby-identifier">name</span> = <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">'_'</span>)&#x000A;                <span class="ruby-identifier">name</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-value str">'_+'</span>, <span class="ruby-value str">'_'</span>)&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">name</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000335'>
                <a name='M000335'>      </a>
                <div class='synopsis'>
                  <span class='name'>sql_add_field</span>
                  <span class='arguments'>(table_name, name, type, attributes)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns an array of SQL statements to add a field.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000335-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000335-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 618</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sql_add_field</span>(<span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">attributes</span>)&#x000A;            [<span class="ruby-node">&quot;ALTER TABLE #{table_name} ADD #{sql_table_field(name, type, attributes)}&quot;</span>]&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000336'>
                <a name='M000336'>      </a>
                <div class='synopsis'>
                  <span class='name'>sql_alter_field</span>
                  <span class='arguments'>(table_name, name, type, attributes)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns an array of SQL statements to alter a field.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000336-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000336-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 623</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sql_alter_field</span>(<span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">attributes</span>)&#x000A;            [<span class="ruby-node">&quot;ALTER TABLE #{table_name} MODIFY #{sql_table_field(name, type, attributes)}&quot;</span>]&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000329'>
                <a name='M000329'>      </a>
                <div class='synopsis'>
                  <span class='name'>sql_alter_table</span>
                  <span class='arguments'>(alter)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns an array of SQL statements for an alter structured description.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000329-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000329-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 549</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sql_alter_table</span>(<span class="ruby-identifier">alter</span>)&#x000A;            <span class="ruby-identifier">current</span> = <span class="ruby-identifier">alter</span>[<span class="ruby-identifier">:current</span>]&#x000A;            <span class="ruby-identifier">table_name</span> = <span class="ruby-identifier">alter</span>[<span class="ruby-identifier">:table</span>]&#x000A;            <span class="ruby-identifier">add_fields</span> = <span class="ruby-identifier">alter</span>[<span class="ruby-identifier">:add_fields</span>]&#x000A;            <span class="ruby-identifier">alter_fields</span> = <span class="ruby-identifier">alter</span>[<span class="ruby-identifier">:alter_fields</span>]&#x000A;            <span class="ruby-identifier">alter_attributes</span> = <span class="ruby-identifier">alter</span>[<span class="ruby-identifier">:attributes</span>]&#x000A;            <span class="ruby-identifier">sqls</span> = []&#x000A;            &#x000A;            <span class="ruby-identifier">add_fields</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">field</span><span class="ruby-operator">|</span>&#x000A;                <span class="ruby-identifier">name</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">attributes</span> = <span class="ruby-identifier">field</span>&#x000A;                <span class="ruby-identifier">sqls</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">sql_add_field</span>(<span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">field</span>[<span class="ruby-identifier">:name</span>], <span class="ruby-identifier">field</span>[<span class="ruby-identifier">:type</span>], <span class="ruby-identifier">field</span>[<span class="ruby-identifier">:attributes</span>])&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-identifier">alter_fields</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">field</span><span class="ruby-operator">|</span>&#x000A;                <span class="ruby-identifier">name</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">attributes</span> = <span class="ruby-identifier">field</span>&#x000A;                <span class="ruby-identifier">sqls</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">sql_alter_field</span>(<span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">field</span>[<span class="ruby-identifier">:name</span>], <span class="ruby-identifier">field</span>[<span class="ruby-identifier">:type</span>], <span class="ruby-identifier">field</span>[<span class="ruby-identifier">:attributes</span>])&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">alter_attributes</span>[<span class="ruby-identifier">:primary_key</span>])&#x000A;                <span class="ruby-identifier">sqls</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;ALTER #{table_name} DROP PRIMARY KEY&quot;</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">current</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">current</span>[<span class="ruby-identifier">:attributes</span>][<span class="ruby-identifier">:primary_key</span>])&#x000A;                <span class="ruby-identifier">sqls</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;ALTER TABLE #{table_name} ADD PRIMARY KEY &quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">alter_attributes</span>[<span class="ruby-identifier">:primary_key</span>].<span class="ruby-identifier">join</span>(<span class="ruby-value str">', '</span>)&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">sqls</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000319'>
                <a name='M000319'>      </a>
                <div class='synopsis'>
                  <span class='name'>sql_condition</span>
                  <span class='arguments'>(query)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns SQL and bound variables for a condition.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000319-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000319-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 407</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sql_condition</span>(<span class="ruby-identifier">query</span>)&#x000A;            <span class="ruby-identifier">condition</span> = <span class="ruby-identifier">query</span>[<span class="ruby-identifier">:condition</span>]&#x000A;            <span class="ruby-keyword kw">return</span> [<span class="ruby-value str">''</span>, []] <span class="ruby-keyword kw">unless</span> (<span class="ruby-identifier">condition</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">condition</span>[<span class="ruby-identifier">:values</span>])&#x000A;            <span class="ruby-identifier">bind_vars</span> = []&#x000A;            <span class="ruby-identifier">mapped</span> = <span class="ruby-identifier">condition</span>[<span class="ruby-identifier">:values</span>].<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span>&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">v</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Hash</span>) <span class="ruby-comment cmt"># subconditions</span>&#x000A;                    <span class="ruby-identifier">sql</span>, <span class="ruby-identifier">vals</span> = <span class="ruby-identifier">sql_condition</span>({<span class="ruby-identifier">:condition</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">v</span>})&#x000A;                    <span class="ruby-identifier">bind_vars</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">vals</span>&#x000A;                    <span class="ruby-operator">!</span><span class="ruby-identifier">sql</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-value">? </span><span class="ruby-node">&quot;(#{sql})&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>&#x000A;                <span class="ruby-keyword kw">else</span>&#x000A;                    <span class="ruby-identifier">v</span>[<span class="ruby-value">1</span>] = <span class="ruby-value str">'between'</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">v</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Range</span>))&#x000A;                    <span class="ruby-identifier">v</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">upcase!</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">v</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'ilike'</span>)&#x000A;                    <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">v</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'between'</span>)&#x000A;                        <span class="ruby-identifier">bind_vars</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">v</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">first</span>&#x000A;                        <span class="ruby-identifier">bind_vars</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">v</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">last</span>&#x000A;                    <span class="ruby-keyword kw">else</span>&#x000A;                        <span class="ruby-identifier">bind_vars</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">v</span>[<span class="ruby-value">2</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">v</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">nil?</span>&#x000A;                    <span class="ruby-keyword kw">end</span>&#x000A;                    <span class="ruby-identifier">sql_condition_value</span>(<span class="ruby-identifier">v</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">v</span>[<span class="ruby-value">1</span>], <span class="ruby-identifier">v</span>[<span class="ruby-value">2</span>])&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">mapped</span>.<span class="ruby-identifier">select</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-identifier">p</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>}.<span class="ruby-identifier">join</span>(<span class="ruby-value str">' '</span><span class="ruby-operator">+</span><span class="ruby-identifier">condition</span>[<span class="ruby-identifier">:conj</span>]<span class="ruby-operator">+</span><span class="ruby-value str">' '</span>), <span class="ruby-identifier">bind_vars</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000320'>
                <a name='M000320'>      </a>
                <div class='synopsis'>
                  <span class='name'>sql_condition_value</span>
                  <span class='arguments'>(key, comp, value)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns the SQL for a condition comparison.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000320-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000320-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 432</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sql_condition_value</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">comp</span>, <span class="ruby-identifier">value</span>)&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">comp</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'ilike'</span>)&#x000A;                <span class="ruby-identifier">comp</span> = <span class="ruby-value str">'like'</span>&#x000A;                <span class="ruby-identifier">key</span> = <span class="ruby-node">&quot;UPPER(#{key})&quot;</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">value</span>.<span class="ruby-identifier">nil?</span>)&#x000A;                <span class="ruby-identifier">comp</span> = <span class="ruby-identifier">comp</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'='</span> <span class="ruby-operator">?</span> <span class="ruby-value str">&quot;IS&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-value str">&quot;IS NOT&quot;</span>&#x000A;                <span class="ruby-identifier">sql</span> = <span class="ruby-node">&quot;#{key} #{comp} NULL&quot;</span>&#x000A;            <span class="ruby-keyword kw">else</span>&#x000A;                <span class="ruby-identifier">sql</span> = <span class="ruby-node">&quot;#{key} #{comp} ?&quot;</span>&#x000A;                <span class="ruby-identifier">sql</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot; AND ?&quot;</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">comp</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'between'</span>)&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">sql</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000328'>
                <a name='M000328'>      </a>
                <div class='synopsis'>
                  <span class='name'>sql_create_table</span>
                  <span class='arguments'>(create)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns an array of SQL statements for a create structured description.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000328-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000328-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 530</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sql_create_table</span>(<span class="ruby-identifier">create</span>)&#x000A;            <span class="ruby-identifier">name</span> = <span class="ruby-identifier">create</span>[<span class="ruby-identifier">:table</span>]&#x000A;            <span class="ruby-identifier">fields</span> = <span class="ruby-identifier">create</span>[<span class="ruby-identifier">:fields</span>]&#x000A;            <span class="ruby-identifier">sql_fields</span> = <span class="ruby-value str">''</span>&#x000A;            <span class="ruby-identifier">fields</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">field</span><span class="ruby-operator">|</span>&#x000A;                <span class="ruby-identifier">attributes</span> = <span class="ruby-identifier">field</span>[<span class="ruby-identifier">:attributes</span>]&#x000A;                <span class="ruby-identifier">attributes</span> <span class="ruby-operator">||=</span> {}&#x000A;                <span class="ruby-identifier">length</span> = <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:length</span>]&#x000A;                <span class="ruby-identifier">sql_fields</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">', '</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">sql_fields</span>.<span class="ruby-identifier">empty?</span>&#x000A;                <span class="ruby-identifier">sql_fields</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">sql_table_field</span>(<span class="ruby-identifier">field</span>[<span class="ruby-identifier">:name</span>], <span class="ruby-identifier">field</span>[<span class="ruby-identifier">:type</span>], <span class="ruby-identifier">attributes</span>)&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">create</span>[<span class="ruby-identifier">:attributes</span>][<span class="ruby-identifier">:primary_key</span>])&#x000A;                <span class="ruby-identifier">primary_key_fields</span> = <span class="ruby-identifier">create</span>[<span class="ruby-identifier">:attributes</span>][<span class="ruby-identifier">:primary_key</span>].<span class="ruby-identifier">join</span>(<span class="ruby-value str">', '</span>)&#x000A;                <span class="ruby-identifier">sql_fields</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;, PRIMARY KEY (#{primary_key_fields})&quot;</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            [<span class="ruby-node">&quot;CREATE TABLE #{name} (#{sql_fields})&quot;</span>]&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000327'>
                <a name='M000327'>      </a>
                <div class='synopsis'>
                  <span class='name'>sql_delete</span>
                  <span class='arguments'>(delete, force=false)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns SQL and bound values for a DELETE statement.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000327-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000327-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 520</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sql_delete</span>(<span class="ruby-identifier">delete</span>, <span class="ruby-identifier">force</span>=<span class="ruby-keyword kw">false</span>)&#x000A;            <span class="ruby-ivar">@last_query_type</span> = <span class="ruby-identifier">:delete</span>&#x000A;            <span class="ruby-identifier">where</span>, <span class="ruby-identifier">bind_vars</span> = <span class="ruby-identifier">sql_condition</span>(<span class="ruby-identifier">delete</span>)&#x000A;            <span class="ruby-identifier">where</span> = <span class="ruby-value str">&quot;1=0&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">force</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">where</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">where</span>.<span class="ruby-identifier">empty?</span>)&#x000A;            <span class="ruby-identifier">sql</span> = <span class="ruby-node">&quot;DELETE FROM #{delete[:table]}&quot;</span>&#x000A;            <span class="ruby-identifier">sql</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot; WHERE #{where}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">where</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">where</span>.<span class="ruby-identifier">empty?</span>&#x000A;            <span class="ruby-keyword kw">return</span> [<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">bind_vars</span>]&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000337'>
                <a name='M000337'>      </a>
                <div class='synopsis'>
                  <span class='name'>sql_drop_field</span>
                  <span class='arguments'>(table_name, field_name)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns an array of SQL statements to drop a field.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000337-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000337-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 628</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sql_drop_field</span>(<span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">field_name</span>)&#x000A;            [<span class="ruby-node">&quot;ALTER TABLE #{table_name} DROP COLUMN #{field_name}&quot;</span>]&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000338'>
                <a name='M000338'>      </a>
                <div class='synopsis'>
                  <span class='name'>sql_drop_table</span>
                  <span class='arguments'>(table_name)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns an array of SQL statements needed to drop a table.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000338-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000338-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 633</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sql_drop_table</span>(<span class="ruby-identifier">table_name</span>)&#x000A;            [<span class="ruby-node">&quot;DROP TABLE #{table_name}&quot;</span>]&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000324'>
                <a name='M000324'>      </a>
                <div class='synopsis'>
                  <span class='name'>sql_insert</span>
                  <span class='arguments'>(insert)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns SQL and values for an insert statement.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000324-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000324-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 493</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sql_insert</span>(<span class="ruby-identifier">insert</span>)&#x000A;            <span class="ruby-ivar">@last_query_type</span> = <span class="ruby-identifier">:insert</span>&#x000A;            <span class="ruby-identifier">sql</span> = <span class="ruby-node">&quot;INSERT INTO #{insert[:table]} (#{insert[:values].keys.join(', ')}) &quot;</span> <span class="ruby-operator">+</span>&#x000A;                  <span class="ruby-node">&quot;VALUES (#{insert[:values].values.map{'?'}.join(', ')})&quot;</span>&#x000A;            <span class="ruby-keyword kw">return</span> [<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">insert</span>[<span class="ruby-identifier">:values</span>].<span class="ruby-identifier">values</span>]&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000321'>
                <a name='M000321'>      </a>
                <div class='synopsis'>
                  <span class='name'>sql_joins</span>
                  <span class='arguments'>(joins)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns SQL and values for DB joins.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000321-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000321-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 461</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sql_joins</span>(<span class="ruby-identifier">joins</span>)&#x000A;            <span class="ruby-identifier">types</span> = {&#x000A;                <span class="ruby-identifier">:inner</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'INNER'</span>, <span class="ruby-identifier">:outer</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'OUTER'</span>, <span class="ruby-identifier">:left_outer</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'LEFT OUTER'</span>, <span class="ruby-identifier">:right_outer</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'RIGHT OUTER'</span>&#x000A;            }&#x000A;            <span class="ruby-identifier">values</span> = []&#x000A;            <span class="ruby-identifier">sql</span> = <span class="ruby-identifier">joins</span>.<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">join</span><span class="ruby-operator">|</span>&#x000A;                <span class="ruby-identifier">sql_on</span> = <span class="ruby-identifier">join</span>[<span class="ruby-identifier">:keys</span>].<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">from_f</span>, <span class="ruby-identifier">to_f</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;#{join[:from]}.#{from_f} = #{join[:to]}.#{to_f}&quot;</span>}.<span class="ruby-identifier">join</span>(<span class="ruby-value str">' AND '</span>)&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">join</span>[<span class="ruby-identifier">:condition</span>])&#x000A;                    <span class="ruby-identifier">condition_sql</span>, <span class="ruby-identifier">condition_values</span> = <span class="ruby-identifier">sql_condition</span>({<span class="ruby-identifier">:condition</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">join</span>[<span class="ruby-identifier">:condition</span>]})&#x000A;                    <span class="ruby-identifier">sql_on</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot; and #{condition_sql}&quot;</span>&#x000A;                    <span class="ruby-identifier">values</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">condition_values</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-node">&quot;#{types[join[:type]]} JOIN #{join[:to]} ON (#{sql_on})&quot;</span>&#x000A;            }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot; &quot;</span>)&#x000A;            <span class="ruby-keyword kw">return</span> [<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">values</span>]&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000316'>
                <a name='M000316'>      </a>
                <div class='synopsis'>
                  <span class='name'>sql_keys</span>
                  <span class='arguments'>(query)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns the SQL for select keys.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000316-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000316-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 368</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sql_keys</span>(<span class="ruby-identifier">query</span>)&#x000A;            <span class="ruby-identifier">query</span>[<span class="ruby-identifier">:keys</span>].<span class="ruby-identifier">join</span>(<span class="ruby-value str">','</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000323'>
                <a name='M000323'>      </a>
                <div class='synopsis'>
                  <span class='name'>sql_limit</span>
                  <span class='arguments'>(query)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns the LIMIT and OFFSET SQL.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000323-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000323-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 485</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sql_limit</span>(<span class="ruby-identifier">query</span>)&#x000A;            <span class="ruby-identifier">sql</span> = <span class="ruby-value str">&quot;&quot;</span>&#x000A;            <span class="ruby-identifier">sql</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;LIMIT #{query[:limit]} &quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">query</span>[<span class="ruby-identifier">:limit</span>]&#x000A;            <span class="ruby-identifier">sql</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;OFFSET #{query[:offset]} &quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">query</span>[<span class="ruby-identifier">:offset</span>]&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">sql</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000322'>
                <a name='M000322'>      </a>
                <div class='synopsis'>
                  <span class='name'>sql_order</span>
                  <span class='arguments'>(query)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns SQL for the ORDER part.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000322-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000322-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 479</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sql_order</span>(<span class="ruby-identifier">query</span>)&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">''</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">query</span>[<span class="ruby-identifier">:order</span>]&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">query</span>[<span class="ruby-identifier">:order</span>].<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">o</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;#{o[0]} #{o[1]}&quot;</span>}.<span class="ruby-identifier">join</span>(<span class="ruby-value str">' ,'</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000315'>
                <a name='M000315'>      </a>
                <div class='synopsis'>
                  <span class='name'>sql_select</span>
                  <span class='arguments'>(query)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns a two element array, containing the SQL for given select query, and
                  the variables to bind.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000315-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000315-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 351</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sql_select</span>(<span class="ruby-identifier">query</span>)&#x000A;            <span class="ruby-ivar">@last_query_type</span> = <span class="ruby-identifier">:select</span>&#x000A;            <span class="ruby-identifier">bind_vars</span> = <span class="ruby-identifier">query</span>[<span class="ruby-identifier">:bind_vars</span>] <span class="ruby-operator">||</span> []&#x000A;            <span class="ruby-identifier">tables_sql</span>, <span class="ruby-identifier">tables_values</span> = <span class="ruby-identifier">sql_tables</span>(<span class="ruby-identifier">query</span>)&#x000A;            <span class="ruby-identifier">sql</span> = <span class="ruby-node">&quot;SELECT #{sql_keys(query)} FROM #{tables_sql} &quot;</span>&#x000A;            <span class="ruby-identifier">bind_vars</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">tables_values</span>&#x000A;            <span class="ruby-identifier">where</span>, <span class="ruby-identifier">vals</span> = <span class="ruby-identifier">sql_condition</span>(<span class="ruby-identifier">query</span>)&#x000A;            <span class="ruby-identifier">bind_vars</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">vals</span>&#x000A;            <span class="ruby-identifier">sql</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;WHERE #{where} &quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">where</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">where</span>.<span class="ruby-identifier">empty?</span>&#x000A;            <span class="ruby-identifier">order</span> = <span class="ruby-identifier">sql_order</span>(<span class="ruby-identifier">query</span>)&#x000A;            <span class="ruby-identifier">sql</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;ORDER BY #{order} &quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">order</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">order</span>.<span class="ruby-identifier">empty?</span>&#x000A;            <span class="ruby-identifier">limit</span> = <span class="ruby-identifier">sql_limit</span>(<span class="ruby-identifier">query</span>)&#x000A;            <span class="ruby-identifier">sql</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">limit</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">limit</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">sql</span>, <span class="ruby-identifier">bind_vars</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000334'>
                <a name='M000334'>      </a>
                <div class='synopsis'>
                  <span class='name'>sql_table_field</span>
                  <span class='arguments'>(name, type, attributes)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns the SQL for a field definition (used in create and alter table)
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000334-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000334-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 601</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sql_table_field</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">attributes</span>)&#x000A;            <span class="ruby-identifier">f</span> = <span class="ruby-node">&quot;#{name} #{type}&quot;</span>&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'DECIMAL'</span>)&#x000A;                <span class="ruby-identifier">f</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;(#{attributes[:precision]}, #{attributes[:scale]})&quot;</span>&#x000A;            <span class="ruby-keyword kw">else</span>&#x000A;                <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:length</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:length</span>] <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>&#x000A;                    <span class="ruby-identifier">f</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;(#{attributes[:length]})&quot;</span>&#x000A;                <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:precision</span>]&#x000A;                    <span class="ruby-identifier">f</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;(#{attributes[:precision]}&quot;</span>&#x000A;                    <span class="ruby-identifier">f</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;#{attributes[:scale]}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:scale</span>]&#x000A;                    <span class="ruby-identifier">f</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot;)&quot;</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">f</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000317'>
                <a name='M000317'>      </a>
                <div class='synopsis'>
                  <span class='name'>sql_tables</span>
                  <span class='arguments'>(query)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns an array containing the &#8216;FROM&#8217; part of an SQL query
                  (including joins), and the bound variables, if any.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000317-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000317-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 374</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sql_tables</span>(<span class="ruby-identifier">query</span>)&#x000A;            <span class="ruby-identifier">values</span> = []&#x000A;            <span class="ruby-identifier">sql</span> = <span class="ruby-identifier">query</span>[<span class="ruby-identifier">:tables</span>].<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">table</span><span class="ruby-operator">|</span>&#x000A;                <span class="ruby-identifier">str</span> = <span class="ruby-identifier">table</span>&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">query</span>[<span class="ruby-identifier">:joins</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">query</span>[<span class="ruby-identifier">:joins</span>][<span class="ruby-identifier">table</span>])&#x000A;                    <span class="ruby-identifier">join_str</span>, <span class="ruby-identifier">join_values</span> = <span class="ruby-identifier">sql_tables_join</span>(<span class="ruby-identifier">query</span>, <span class="ruby-identifier">table</span>)&#x000A;                    <span class="ruby-identifier">str</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot; &quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">join_str</span>&#x000A;                    <span class="ruby-identifier">values</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">join_values</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-identifier">str</span>&#x000A;            }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">', '</span>)&#x000A;            <span class="ruby-keyword kw">return</span> [<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">values</span>]&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000318'>
                <a name='M000318'>      </a>
                <div class='synopsis'>
                  <span class='name'>sql_tables_join</span>
                  <span class='arguments'>(query, table)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns SQL and bound variables for joins.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000318-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000318-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 389</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sql_tables_join</span>(<span class="ruby-identifier">query</span>, <span class="ruby-identifier">table</span>)&#x000A;            <span class="ruby-identifier">str</span> = <span class="ruby-value str">&quot;&quot;</span>&#x000A;            <span class="ruby-identifier">values</span> = []&#x000A;            <span class="ruby-identifier">query</span>[<span class="ruby-identifier">:joins</span>][<span class="ruby-identifier">table</span>].<span class="ruby-identifier">each_key</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">to_table</span><span class="ruby-operator">|</span>&#x000A;                <span class="ruby-identifier">join</span>, <span class="ruby-identifier">join_values</span> = <span class="ruby-identifier">sql_joins</span>(<span class="ruby-identifier">query</span>[<span class="ruby-identifier">:joins</span>][<span class="ruby-identifier">table</span>][<span class="ruby-identifier">to_table</span>])&#x000A;                <span class="ruby-identifier">str</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot; &quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">join</span>&#x000A;                <span class="ruby-identifier">values</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">join_values</span>&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">query</span>[<span class="ruby-identifier">:joins</span>][<span class="ruby-identifier">to_table</span>])&#x000A;                    <span class="ruby-identifier">query</span>[<span class="ruby-identifier">:joins</span>][<span class="ruby-identifier">to_table</span>].<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">table</span>) <span class="ruby-comment cmt"># avoid endless loop</span>&#x000A;                    <span class="ruby-identifier">sub_str</span>, <span class="ruby-identifier">sub_values</span> = <span class="ruby-identifier">sql_tables_join</span>(<span class="ruby-identifier">query</span>, <span class="ruby-identifier">to_table</span>)&#x000A;                    <span class="ruby-identifier">str</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot; &quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">sub_str</span>&#x000A;                    <span class="ruby-identifier">values</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">sub_values</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">str</span>, <span class="ruby-identifier">values</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000325'>
                <a name='M000325'>      </a>
                <div class='synopsis'>
                  <span class='name'>sql_update</span>
                  <span class='arguments'>(update)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns SQL and values for an update statement.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000325-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000325-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 501</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sql_update</span>(<span class="ruby-identifier">update</span>)&#x000A;            <span class="ruby-ivar">@last_query_type</span> = <span class="ruby-identifier">:update</span>&#x000A;            <span class="ruby-identifier">values</span> = <span class="ruby-identifier">update</span>[<span class="ruby-identifier">:values</span>].<span class="ruby-identifier">values</span>&#x000A;            <span class="ruby-identifier">sql</span> = <span class="ruby-node">&quot;UPDATE #{update[:table]} SET &quot;</span>&#x000A;            <span class="ruby-identifier">sql</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">sql_update_values</span>(<span class="ruby-identifier">update</span>)&#x000A;            <span class="ruby-identifier">where</span>, <span class="ruby-identifier">bind_vars</span> = <span class="ruby-identifier">sql_condition</span>(<span class="ruby-identifier">update</span>)&#x000A;            <span class="ruby-identifier">values</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">bind_vars</span>&#x000A;            <span class="ruby-identifier">sql</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot; WHERE #{where}&quot;</span>&#x000A;            <span class="ruby-keyword kw">return</span> [<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">values</span>]&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000326'>
                <a name='M000326'>      </a>
                <div class='synopsis'>
                  <span class='name'>sql_update_values</span>
                  <span class='arguments'>(update)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns the COLUMN = val, &#8230; part of an update statement.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000326-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000326-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 513</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sql_update_values</span>(<span class="ruby-identifier">update</span>)&#x000A;            <span class="ruby-identifier">update</span>[<span class="ruby-identifier">:values</span>].<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> &#x000A;                <span class="ruby-node">&quot;#{k} = ?&quot;</span>&#x000A;            }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">', '</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000299'>
                <a name='M000299'>      </a>
                <div class='synopsis'>
                  <span class='name'>start_transaction</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  May be implemented by subclasses.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000299-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000299-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 180</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">start_transaction</span>&#x000A;           <span class="ruby-identifier">raise</span> <span class="ruby-constant">StorageException</span>, <span class="ruby-value str">&quot;The current storage does not support transactions&quot;</span> &#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000297'>
                <a name='M000297'>      </a>
                <div class='synopsis'>
                  <span class='name'>supports?</span>
                  <span class='arguments'>(capability)</span>
                </div>
                <div class='description'>
                  <p>
                  True if given named capability is supported by the DB.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000297-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000297-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 171</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">supports?</span>(<span class="ruby-identifier">capability</span>)&#x000A;            <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">capabilities</span>[<span class="ruby-identifier">capability</span>]&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000298'>
                <a name='M000298'>      </a>
                <div class='synopsis'>
                  <span class='name'>supports_transactions?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000298-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000298-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 175</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">supports_transactions?</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">capabilities</span>[<span class="ruby-identifier">:transactions</span>]&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000304'>
                <a name='M000304'>      </a>
                <div class='synopsis'>
                  <span class='name'>table_name</span>
                  <span class='arguments'>(name)</span>
                </div>
                <div class='description'>
                  <p>
                  Fixes a string to be used as a table name.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000304-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000304-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 212</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">table_name</span>(<span class="ruby-identifier">name</span>)&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">':'</span>, <span class="ruby-value str">'_'</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000311'>
                <a name='M000311'>      </a>
                <div class='synopsis'>
                  <span class='name'>value_for_condition</span>
                  <span class='arguments'>(type, value)</span>
                </div>
                <div class='description'>
                  <p>
                  Prepares a value that will be used in a condition.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000311-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000311-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 299</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">value_for_condition</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">value</span>)&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">prepare_value</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">value</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000310'>
                <a name='M000310'>      </a>
                <div class='synopsis'>
                  <span class='name'>value_for_save</span>
                  <span class='arguments'>(type, value, save_mode)</span>
                </div>
                <div class='description'>
                  <p>
                  Prepares a value for saving.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000310-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000310-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 294</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">value_for_save</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">value</span>, <span class="ruby-identifier">save_mode</span>)&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">prepare_value</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">value</span>)&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000312'>
                <a name='M000312'>      </a>
                <div class='synopsis'>
                  <span class='name'>value_to_mapper</span>
                  <span class='arguments'>(type, value)</span>
                </div>
                <div class='description'>
                  <p>
                  Converts a value loaded from the DB to return it to the mapper.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000312-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000312-source'><span class="ruby-comment cmt"># File lib/spiderfw/model/storage/db/db_storage.rb, line 304</span>&#x000A;        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">value_to_mapper</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">value</span>)&#x000A;            <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">type</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'String'</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">type</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'Spider::DataTypes::Text'</span>)&#x000A;                <span class="ruby-identifier">enc</span> = <span class="ruby-ivar">@configuration</span>[<span class="ruby-value str">'encoding'</span>]&#x000A;                <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">enc</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">enc</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">'utf-8'</span>)&#x000A;                    <span class="ruby-keyword kw">begin</span>&#x000A;                        <span class="ruby-identifier">value</span> = <span class="ruby-constant">Iconv</span>.<span class="ruby-identifier">conv</span>(<span class="ruby-value str">'utf-8//IGNORE'</span>, <span class="ruby-identifier">enc</span>, <span class="ruby-identifier">value</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>&#x000A;                    <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Iconv</span><span class="ruby-operator">::</span><span class="ruby-constant">InvalidCharacter</span>&#x000A;                        <span class="ruby-identifier">value</span> = <span class="ruby-value str">''</span>&#x000A;                    <span class="ruby-keyword kw">end</span>&#x000A;                <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">value</span>&#x000A;        <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
